const PDFDocument = require('pdfkit');
const fs = require('fs');
const path = require('path');

// Ensure uploads directory exists
const uploadsDir = path.join(__dirname, '..', 'public', 'uploads');
if (!fs.existsSync(uploadsDir)) {
  fs.mkdirSync(uploadsDir, { recursive: true });
}

// Create sample Proof of Delivery PDF
function createProofOfDeliveryPDF(filename, loadNumber, customer) {
  const doc = new PDFDocument();
  const filePath = path.join(uploadsDir, filename);
  
  doc.pipe(fs.createWriteStream(filePath));
  
  // Header
  doc.fontSize(20).text('PROOF OF DELIVERY', 50, 50);
  doc.fontSize(16).text('Absolute TMS', 50, 80);
  
  // Horizontal line
  doc.moveTo(50, 110).lineTo(550, 110).stroke();
  
  // Load Information
  doc.fontSize(14).text(`Load Number: ${loadNumber}`, 50, 130);
  doc.text(`Customer: ${customer}`, 50, 150);
  doc.text(`Delivery Date: ${new Date().toLocaleDateString()}`, 50, 170);
  doc.text(`Delivery Time: ${new Date().toLocaleTimeString()}`, 50, 190);
  
  // Delivery Details
  doc.fontSize(16).text('Delivery Details:', 50, 230);
  doc.fontSize(12).text('• All items delivered in good condition', 50, 250);
  doc.text('• No damages reported', 50, 270);
  doc.text('• Customer signature obtained', 50, 290);
  doc.text('• Delivery completed successfully', 50, 310);
  
  // Signature section
  doc.fontSize(14).text('Received by:', 50, 360);
  doc.text('Signature: _________________________', 50, 380);
  doc.text('Print Name: _______________________', 50, 400);
  doc.text('Date: ____________________________', 50, 420);
  
  // Footer
  doc.fontSize(10).text('This document serves as proof of successful delivery.', 50, 750);
  doc.text('Generated by Absolute TMS - Professional Transportation Management', 50, 765);
  
  doc.end();
  console.log(`Created: ${filename}`);
}

// Create sample Rate Confirmation PDF
function createRateConfirmationPDF(filename, loadNumber, customer, rate) {
  const doc = new PDFDocument();
  const filePath = path.join(uploadsDir, filename);
  
  doc.pipe(fs.createWriteStream(filePath));
  
  // Header
  doc.fontSize(20).text('RATE CONFIRMATION', 50, 50);
  doc.fontSize(16).text('Absolute TMS', 50, 80);
  
  // Horizontal line
  doc.moveTo(50, 110).lineTo(550, 110).stroke();
  
  // Load Information
  doc.fontSize(14).text(`Load Number: ${loadNumber}`, 50, 130);
  doc.text(`Customer: ${customer}`, 50, 150);
  doc.text(`Confirmation Date: ${new Date().toLocaleDateString()}`, 50, 170);
  doc.text(`Rate: $${rate.toLocaleString()}`, 50, 190);
  
  // Rate Details
  doc.fontSize(16).text('Rate Agreement:', 50, 230);
  doc.fontSize(12).text(`• Total transportation rate: $${rate.toLocaleString()}`, 50, 250);
  doc.text('• Fuel surcharge included', 50, 270);
  doc.text('• Payment terms: Net 30 days', 50, 290);
  doc.text('• All applicable taxes included', 50, 310);
  
  // Terms and Conditions
  doc.fontSize(14).text('Terms & Conditions:', 50, 360);
  doc.fontSize(10).text('1. Rate is valid for the specified load only', 50, 380);
  doc.text('2. Payment due within 30 days of delivery', 50, 395);
  doc.text('3. Late payments subject to 1.5% monthly service charge', 50, 410);
  doc.text('4. Customer responsible for detention charges after 2 hours', 50, 425);
  
  // Signatures
  doc.fontSize(12).text('Carrier: _________________________ Date: _________', 50, 480);
  doc.text('Customer: ________________________ Date: _________', 50, 500);
  
  // Footer
  doc.fontSize(10).text('This rate confirmation is binding upon both parties.', 50, 750);
  doc.text('Generated by Absolute TMS - Professional Transportation Management', 50, 765);
  
  doc.end();
  console.log(`Created: ${filename}`);
}

// Create sample PDFs for demo data
createProofOfDeliveryPDF('POD_L-2024-001_electronics.pdf', 'L-2024-001', 'ABC Logistics Inc.');
createRateConfirmationPDF('RC_L-2024-002_automotive.pdf', 'L-2024-002', 'Global Freight Solutions', 3890);
createProofOfDeliveryPDF('POD_L-2024-003_food.pdf', 'L-2024-003', 'Maritime Transport Co.');
createRateConfirmationPDF('RC_L-2024-003_food.pdf', 'L-2024-003', 'Maritime Transport Co.', 5120);

console.log('Sample PDF files created successfully!');